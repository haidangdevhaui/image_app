(function(){function g(){$(".editor-frame").css({top:($(".app-editor-content").height()-$(".editor-frame").height())/2,left:($(".app-editor-content").width()-$(".editor-frame").width())/2});b.left=($(".app-editor-content").width()-$(".editor-upload").width())/2;b.top=($(".app-editor-content").height()-$(".editor-upload").height())/2;b.rotate=0;$(".editor-upload, .editor-object").css({top:b.top,left:b.left,transform:"rotate(0deg)"})}var h=0,k=0,b={width:380,height:270,top:0,left:0,rotate:0,image:"public/images/default.jpg"},
f=$("<div>",{"class":"ui-rotatable-handle"}),l=f.clone(),m=f.clone();$(".editor-object").css({width:b.width,height:b.height});$(".editor-object-rero").resizable({aspectRatio:!0,alsoResize:".editor-upload, .editor-object",classes:{"ui-resizable":"highlight"}}).rotatable({wheelRotate:!1,start:function(b,a){},rotate:function(b,a){$(".editor-upload").css({transform:"rotate("+a.angle.current+"rad)"})},stop:function(e,a){b.rotate=a.angle.degrees}});$(".editor-object-rero div.ui-rotatable-handle").addClass("ui-rotatable-handle-sw");
f.addClass("ui-rotatable-handle-nw fa fa-square");l.addClass("ui-rotatable-handle-ne fa fa-square");m.addClass("ui-rotatable-handle-se fa fa-square");$(".ui-rotatable-handle-sw").addClass("fa fa-square");$(".editor-object-rero").append(f,l,m);$(".editor-object-rero div[class*='ui-rotatable-handle-']").bind("mousedown",function(b){$(".editor-object-rero").rotatable("instance").startRotate(b)});$(".editor-upload").append('<img style="width: 100%; height: 100%" src="'+b.image+'"/>').css({width:b.width,
height:b.height,border:"2px solid #ea0437"});$(".editor-frame").append('<img class="editor-frame-image" src="public/images/frame_for_front.png"/>').css({width:325,height:204});g();(function(){$(".editor-object").draggable({start:function(b,a){var d=parseInt($(this).css("left"),10);d=isNaN(d)?0:d;var c=parseInt($(this).css("top"),10);c=isNaN(c)?0:c;h=d-a.position.left;k=c-a.position.top},drag:function(e,a){var d=$(this).position();d.transform=b.rotate+"deg";$(".editor-upload").css(d);a.position.left+=
h;a.position.top+=k;$(".editor-upload").css(a.position);b.left=a.position.left;b.top=a.position.top},stop:function(){},cursor:"move",containment:"#editor-content",scroll:!1,cancel:".ui-rotatable-handle"})})();$(".btn-restore").on("click",function(){$(".editor-upload, .editor-object-rero, .editor-object").css({width:b.width,height:b.height});g();$(".file-output").html("").removeAttr("title");$(".file-name").val("");$(".file-ext").val("jpg");$(".file-zoom").val("2");$(".editor-object-rero").css("transform",
"rotate(0deg)").data("uiRotatable").angle(0)});$(".btn-rotate").on("click",function(){b.rotate++;$(".editor-upload, .editor-object").css("transform","rotate("+b.rotate+"deg)")});$(".btn-move-left").on("click",function(){b.left--;$(".editor-upload, .editor-object").css({left:b.left})});$(".btn-move-right").on("click",function(){b.left++;$(".editor-upload, .editor-object").css({left:b.left})});$(".btn-move-top").on("click",function(){b.top--;$(".editor-upload, .editor-object").css({top:b.top})});$(".btn-move-bottom").on("click",
function(){b.top++;$(".editor-upload, .editor-object").css({top:b.top})});$(".btn-create").on("click",function(){var e=$(this);e.html('<i class="fa fa-spinner fa-spin fa-2x"></i>').attr("disabled","");$(".app-editor-content").width();$(".app-editor-content").height();$(".editor-frame").width();$(".editor-frame").height();$(".editor-upload").width();$(".editor-upload").height();$(".editor-upload").position();$(".editor-upload").position();var a=new FormData;a.append("background[width]",$(".app-editor-content").width());
a.append("background[height]",$(".app-editor-content").height());a.append("frame[width]",$(".editor-frame").width());a.append("frame[height]",$(".editor-frame").height());a.append("frame[image]","public/images/frame_for_front.png");a.append("upload[width]",$(".editor-upload").width());a.append("upload[height]",$(".editor-upload").height());a.append("upload[top]",$(".editor-upload").position().top);a.append("upload[left]",$(".editor-upload").position().left);a.append("upload[rotate]",b.rotate);a.append("upload[image]",
b.image);$(".file-name").val()&&a.append("file_name",$(".file-name").val());$(".file-ext").val()&&a.append("file_ext",$(".file-ext").val());$(".file-zoom").val()&&a.append("file_zoom",$(".file-zoom").val());b.imageObj&&a.append("file",b.imageObj);$.ajax({url:"process.php",type:"POST",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){e.html('<i class="fa fa-save fa-2x">').removeAttr("disabled");a=JSON.parse(a);if(a.error)return $(".file-preview-dialog").html('<p style="text-align:center">'+
a.error+"</p>").dialog({modal:!0,buttons:{Ok:function(){$(this).dialog("close")}}});var c=a.path.replace("public/images/created/",""),d=c;18<=c.length&&(c=c.substr(0,15)+"...");$(".file-output").html('<i class="fa fa-file-photo-o"></i> '+c).attr("title",a.path);return $(".file-preview-dialog").html('<img src="'+a.path+'" style="width: 100%; height: 100%"/>').dialog({resizable:!1,draggable:!1,width:b.width,modal:!0,position:{my:"center",at:"top",of:".app-editor-content"},buttons:{download:{text:"Download",
click:function(){var b=new XMLHttpRequest;b.open("GET",a.path,!0);b.responseType="blob";b.onload=function(a){download(b.response,d);$(".file-preview-dialog").dialog("close")};b.send()}},"delete":{text:"Delete",click:function(){$.ajax({url:"delete.php?path="+a.path,type:"GET",success:function(){$(".file-preview-dialog").dialog("close")}})}}}})}})});$("button").click(function(){$(".file-output").html("")});$(".btn-upload").click(function(){$("#file-input").click()});$("#file-input").change(function(){if($(this)[0].files[0]){b.imageObj=
$(this)[0].files[0];var e=new FileReader;e.onload=function(a){$(".btn-restore").trigger("click");$(".editor-upload").find("img").attr("src",a.target.result)};e.readAsDataURL(b.imageObj)}})})();