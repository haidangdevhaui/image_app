(function(){function g(){$(".editor-frame").css({top:($(".app-editor-content").height()-$(".editor-frame").height())/2,left:($(".app-editor-content").width()-$(".editor-frame").width())/2});a.left=($(".app-editor-content").width()-$(".editor-upload").width())/2;a.top=($(".app-editor-content").height()-$(".editor-upload").height())/2;a.rotate=0;$(".editor-upload, .editor-object").css({top:a.top,left:a.left,transform:"rotate(0deg)"})}var h=0,k=0,a={width:380,height:270,top:0,left:0,rotate:0,image:"public/images/default.jpg"},
e=$("<div>",{"class":"ui-rotatable-handle"}),l=e.clone(),m=e.clone();$(".editor-object").css({width:a.width,height:a.height});$(".editor-object-rero").resizable({aspectRatio:!0,alsoResize:".editor-upload, .editor-object",classes:{"ui-resizable":"highlight"}}).rotatable({wheelRotate:!1,start:function(a,b){},rotate:function(a,b){$(".editor-upload").css({transform:"rotate("+b.angle.current+"rad)"})},stop:function(c,b){a.rotate=b.angle.degrees}});$(".editor-object-rero div.ui-rotatable-handle").addClass("ui-rotatable-handle-sw");
e.addClass("ui-rotatable-handle-nw fa fa-square");l.addClass("ui-rotatable-handle-ne fa fa-square");m.addClass("ui-rotatable-handle-se fa fa-square");$(".ui-rotatable-handle-sw").addClass("fa fa-square");$(".editor-object-rero").append(e,l,m);$(".editor-object-rero div[class*='ui-rotatable-handle-']").bind("mousedown",function(a){$(".editor-object-rero").rotatable("instance").startRotate(a)});$(".editor-upload").append('<img style="width: 100%; height: 100%" src="'+a.image+'"/>').css({width:a.width,
height:a.height,border:"2px solid #ea0437"});$(".editor-frame").append('<img class="editor-frame-image" src="public/images/frame_for_front.png"/>').css({width:325,height:204});g();(function(){$(".editor-object").draggable({start:function(a,b){var d=parseInt($(this).css("left"),10);d=isNaN(d)?0:d;var f=parseInt($(this).css("top"),10);f=isNaN(f)?0:f;h=d-b.position.left;k=f-b.position.top},drag:function(c,b){var d=$(this).position();d.transform=a.rotate+"deg";$(".editor-upload").css(d);b.position.left+=
h;b.position.top+=k;$(".editor-upload").css(b.position);a.left=b.position.left;a.top=b.position.top},stop:function(){},cursor:"move",containment:"#editor-content",scroll:!1,cancel:".ui-rotatable-handle"})})();$(".btn-restore").on("click",function(){$(".editor-upload, .editor-object-rero, .editor-object").css({width:a.width,height:a.height});g();$(".file-output").html("").removeAttr("title");$(".file-name").val("");$(".file-ext").val("jpg");$(".editor-object-rero").css("transform","rotate(0deg)").data("uiRotatable").angle(0)});
$(".btn-rotate").on("click",function(){a.rotate++;$(".editor-upload, .editor-object").css("transform","rotate("+a.rotate+"deg)")});$(".btn-move-left").on("click",function(){a.left--;$(".editor-upload, .editor-object").css({left:a.left})});$(".btn-move-right").on("click",function(){a.left++;$(".editor-upload, .editor-object").css({left:a.left})});$(".btn-move-top").on("click",function(){a.top--;$(".editor-upload, .editor-object").css({top:a.top})});$(".btn-move-bottom").on("click",function(){a.top++;
$(".editor-upload, .editor-object").css({top:a.top})});$(".btn-create").on("click",function(){var c=$(this);c.html('<i class="fa fa-spinner fa-spin fa-2x"></i>').attr("disabled","");$(".app-editor-content").width();$(".app-editor-content").height();$(".editor-frame").width();$(".editor-frame").height();$(".editor-upload").width();$(".editor-upload").height();$(".editor-upload").position();$(".editor-upload").position();var b=new FormData;b.append("background[width]",$(".app-editor-content").width());
b.append("background[height]",$(".app-editor-content").height());b.append("frame[width]",$(".editor-frame").width());b.append("frame[height]",$(".editor-frame").height());b.append("frame[image]","public/images/frame_for_front.png");b.append("upload[width]",$(".editor-upload").width());b.append("upload[height]",$(".editor-upload").height());b.append("upload[top]",$(".editor-upload").position().top);b.append("upload[left]",$(".editor-upload").position().left);b.append("upload[rotate]",a.rotate);b.append("upload[image]",
a.image);$(".file-name").val()&&b.append("file_name",$(".file-name").val());$(".file-ext").val()&&b.append("file_ext",$(".file-ext").val());a.imageObj&&b.append("file",a.imageObj);$.ajax({url:"process.php",type:"POST",data:b,cache:!1,contentType:!1,processData:!1,success:function(a){c.html('<i class="fa fa-save fa-2x">').removeAttr("disabled");a=JSON.parse(a);if(a.error)return alert(a.error);var b=a.path.replace("public/images/created/","");14<=b.length&&(b=b.substr(0,11)+"...");$(".file-output").html("Last output:"+
b).attr("title",a.path);return window.open(a.path)}})});$("button").click(function(){$(".file-output").html("")});$(".btn-upload").click(function(){$("#file-input").click()});$("#file-input").change(function(){if($(this)[0].files[0]){a.imageObj=$(this)[0].files[0];var c=new FileReader;c.onload=function(a){$(".btn-restore").trigger("click");$(".editor-upload").find("img").attr("src",a.target.result)};c.readAsDataURL(a.imageObj)}})})();